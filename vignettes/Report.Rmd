---
title: "Raportin luvun 3 kuviot"
author: "Janne Huovari"
date: "`r Sys.Date()`"
output: rmarkdown::html_document

---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  fig.path = "fig_report/",
  fig.width = 10,
  fig.height = 8,
  collapse = TRUE,
  comment = "#>", 
  echo = FALSE, 
  comment = FALSE, 
  warning = FALSE
)


library(tidyverse)
library(glue)
library(ggptt)
library(patchwork)
library(ficomp)
library(gt)
library(tidyselect)

devtools::load_all()

set_gg(theme_ptt(), ptt_pal)

# Data

data("data_main_groups", "data_main10_groups", "ssca10_est_results", "ssca_lp_ind", "ssca_exp_est_results")
data("weights_ecfin27", "weights_ecfin37", package = "ficomp")



high_country <- "Suomi"
high_countries <- c("Ruotsi", "Euroalue-12", "Saksa", "Yhdysvallat", "Alankomaat")

plot_start_year <- 2000

```

# Työn tuottavuus

Työn tuottavuuden kasvu keskimäärin 1995-2019

```{r bar_change, fig.height=10}

order_fun <- function(.x, .y) mean(.x[.y == "private"])

data_main10_groups %>% 
  group_by(geo, nace0) %>% 
  filter(time >= 2015) %>% 
  transmute(lp_change = 100 * (lp_ind / lag(lp_ind) -1)) %>% 
  summarise(values = mean(lp_change, na.rm = TRUE)) %>% 
  ungroup() %>% 
  mutate(
    nace0 = fct_relevel(nace0, "private"),
    geo = fct_reorder2(geo, values, nace0, .fun = order_fun)) %>% 
  ggplot(aes(geo, values, label = round(values, 1))) +
  geom_col(position = "dodge") +
  facet_wrap(~ nace0) +
  geom_text(colour = "black", hjust = "top", nudge_y = 0.5) +
  coord_flip()
  # spread(nace0, values) %>% 
  # arrange(-private) %>% 
  # gt() %>% 
  # fmt_number(columns = vars(private, manu, service), decimals = 1)

```


## Yksityinen sektori

```{r private}

trip_plot(ssca_obj = ssca10_est_results$lp_ind$model$private, "lp_ind", base_year, high_country, high_countries)

# ggsave(here::here("figures/manu.pdf"), width = 10, height = 8)
# ggsave(here::here("figures/manu.svg"), width = 10, height = 8)
# ggsave(here::here("figures/manu.png"), width = 10, height = 8)
# ggsave(here::here("figures/manu.eps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.ps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.wmf"), width = 10, height = 8)


ssca_table(ssca10_est_results$lp_ind$model$private)



```

```{r private_weight, fig.height=4}


rel_plot2(data_main10_g_weighted, "private")


```


## Yksityinen sektori ilman elektroniikkateollisuutta


```{r private_ex26}

trip_plot(ssca_lp_ind$model$private_ex26, "lp_ind", base_year, high_country, high_countries)

ssca_table(ssca_lp_ind$model$private_ex26)

```

## Teollisuus


```{r manu}

trip_plot(ssca10_est_results$lp_ind$model$manu, "lp_ind", base_year, high_country, high_countries)

# ggsave(here::here("figures/manu.pdf"), width = 10, height = 8)
# ggsave(here::here("figures/manu.svg"), width = 10, height = 8)
# ggsave(here::here("figures/manu.png"), width = 10, height = 8)
# ggsave(here::here("figures/manu.eps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.ps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.wmf"), width = 10, height = 8)


ssca_table(ssca10_est_results$lp_ind$model$manu)

```

```{r manu_weight, fig.height=4}


rel_plot2(data_main10_g_weighted, "manu")

```



## Teollisuus ilman elektroniikkateollisuutta

```{r manu_ex26}

trip_plot(ssca_lp_ind$model$manu_ex26, "lp_ind", base_year, high_country, high_countries)

# ggsave(here::here("figures/manu.pdf"), width = 10, height = 8)
# ggsave(here::here("figures/manu.svg"), width = 10, height = 8)
# ggsave(here::here("figures/manu.png"), width = 10, height = 8)
# ggsave(here::here("figures/manu.eps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.ps"), width = 10, height = 8)
# ggsave(here::here("figures/manu.wmf"), width = 10, height = 8)


ssca_table(ssca_lp_ind$model$manu_ex26)

```

## Palvelut



```{r service}

trip_plot(ssca10_est_results$lp_ind$model$service, "lp_ind", base_year, high_country, high_countries)


ssca_table(ssca10_est_results$lp_ind$model$service)

```

```{r service_weight, fig.height=4}


rel_plot2(data_main10_g_weighted, "service")

```

# Muut muuttujat 

## BKT

```{r bkt}


trip_plot(ssca10_est_results$va_ind$model$private, "va_ind", base_year, high_country, high_countries)


ssca_table(ssca10_est_results$va_ind$model$private)

```


## Työtunnit

```{r h}


trip_plot(ssca10_est_results$h_ind$model$private, "h_ind", base_year, high_country, high_countries)


ssca_table(ssca10_est_results$h_ind$model$private)

```



# Vienti

```{r export}


trip_plot(ssca_obj = ssca_exp_est_results$p6_ind, "p6_ind", base_year, high_country, high_countries)


ssca_table(ssca_exp_est_results$p6_ind)

```

# Tavaroiden vienti

```{r export_good}


trip_plot(ssca_obj = ssca_exp_est_results$p61_ind, "p6_ind", base_year, high_country, high_countries)


ssca_table(ssca_exp_est_results$p61_ind)

```

# Palveluiden vienti

```{r export_serv}


trip_plot(ssca_obj = ssca_exp_est_results$p62_ind, "p6_ind", base_year, high_country, high_countries)


ssca_table(ssca_exp_est_results$p62_ind)

```
